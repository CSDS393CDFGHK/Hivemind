<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello World</title>
</head>
<body> 
    <script src="../shared/Message.js"></script>
    <script src="../shared/MessageType.js"></script>
    <script src="../shared/Player.js"></script>
    <script type="text/javascript">
        console.log("Hello World");

        // Let us open a web socket
        var ws = new WebSocket("ws://localhost:8000");

        ws.onopen = function() {
          // Web Socket is connected, send data using send()

          // Create lobby
          let m = new Message(-1, "ownerid", MessageType.CREATE_LOBBY, "1");
          ws.send(m.toJSON());   
        };

        ws.onmessage = function (evt) {
          var message = evt.data;
          console.log("Received: " + message);
          let msg = Message.fromJSON(message);
          
          if (msg.type == MessageType.USERNAME) {
            console.log("New player creation with message: " + msg);
            console.log("New player data: " + msg.data);
            let p = new Player(msg.data);
            console.log("New player: " + p);
          }

          if (msg.type == MessageType.LOBBY_ID) {
            let lobbyID = msg.lobbyID;
            // Send a username
            m = new Message(-1, "ownerid", MessageType.USERNAME, lobbyID, {"username":"CoolGuy32"});
            ws.send(m.toJSON());    
            // Add a player and change their username
            m = new Message(-1, "newid", MessageType.PLAYER_JOIN, lobbyID);
            ws.send(m.toJSON());
            m = new Message(-1, "newid", MessageType.USERNAME, lobbyID, {"username":"TestSubjectBlue"});
            ws.send(m.toJSON());   
          }
        };

        ws.onclose = function() {

          // websocket is closed.
          console.log("Connection is closed");
        };
    </script>
</body>
</html>